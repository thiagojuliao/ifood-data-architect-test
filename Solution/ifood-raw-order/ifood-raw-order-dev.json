{"paragraphs":[{"title":"Inicialização dos pacotes, definindo funções e variáveis","text":"%pyspark\n\n###############################################\n#   Importando pacotes & definindo funções    #\n###############################################\n\nfrom datetime import *\nfrom pyspark import StorageLevel\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.types import *\n\n###############################\n#   Definição de variáveis    #\n###############################\n\n# Definição do Schema de garnishItems que é um Array dentro de Items\nschema_value_currency = StructType([StructField(\"value\", StringType()), StructField(\"currency\", StringType())])\nschema_garnish = StructType(\n    [\n        StructField(\"name\", StringType()),\n        StructField(\"addition\", schema_value_currency),\n        StructField(\"discount\", schema_value_currency),\n        StructField(\"quantity\", DoubleType()),\n        StructField(\"sequence\", IntegerType()),\n        StructField(\"unitPrice\", schema_value_currency),\n        StructField(\"categoryId\", StringType()),\n        StructField(\"externalId\", StringType()),\n        StructField(\"totalValue\", schema_value_currency),\n        StructField(\"categoryName\", StringType()),\n        StructField(\"integrationId\", StringType())\n    ])\n\n# Definição do Schema do Array de Items\nschema_items = StructType(\n    [\n        StructField(\"name\", StringType()),\n        StructField(\"addition\", schema_value_currency),\n        StructField(\"discount\", schema_value_currency),\n        StructField(\"quantity\", DoubleType()),\n        StructField(\"sequence\", IntegerType()),\n        StructField(\"unitPrice\", schema_value_currency),\n        StructField(\"externalId\", StringType()),\n        StructField(\"totalValue\", schema_value_currency),\n        StructField(\"customerNote\", StringType()),\n        StructField(\"garnishItems\", ArrayType(schema_garnish)),\n        StructField(\"integrationId\", StringType()),\n        StructField(\"totalAddition\", schema_value_currency),\n        StructField(\"totalDiscount\", schema_value_currency)\n    ])\n\n# Definação do schema json\nschema_json = StructType(\n    [\n        StructField(\"cpf\", StringType()),\n        StructField(\"customer_id\", StringType()),\n        StructField(\"customer_name\", StringType()),\n        StructField(\"delivery_address_city\", StringType()),\n        StructField(\"delivery_address_country\", StringType()),\n        StructField(\"delivery_address_district\", StringType()),\n        StructField(\"delivery_address_external_id\", StringType()),\n        StructField(\"delivery_address_latitude\", StringType()),\n        StructField(\"delivery_address_longitude\", StringType()),\n        StructField(\"delivery_address_state\", StringType()),\n        StructField(\"delivery_address_zip_code\", StringType()),\n        StructField(\"items\", StringType()),\n        StructField(\"merchant_id\", StringType()),\n        StructField(\"merchant_latitude\", StringType()),\n        StructField(\"merchant_longitude\", StringType()),\n        StructField(\"merchant_timezone\", StringType()),\n        StructField(\"order_created_at\", StringType()),\n        StructField(\"order_id\", StringType()),\n        StructField(\"order_scheduled\", BooleanType()),\n        StructField(\"order_scheduled_date\", StringType()),\n        StructField(\"order_total_amount\", DoubleType()),\n        StructField(\"origin_platform\", StringType())\n    ])\n\n# Caminho de origem da pouso order\norigem_pouso = \"hdfs://localhost:9000/ifood-landing-order/full-load/order.json.gz\"\n\n# Caminho de destino da raw order\ndestino_raw = \"hdfs://localhost:9000/ifood-raw-order/\"\n\n# Inicia sessão spark\nspark = SparkSession.builder.appName(\"ifood-raw-order-dev\").getOrCreate()\n\n# Configurações básicas para o spark\nspark.conf.set(\"spark.sql.maxPartitionBytes\", 200 * 1024 * 1024) # Seta a quantidade máxima de bytes em uma partição ao ler os arquivos de entrada (Entre 100MB e 200MB é o ideal)\nspark.conf.set(\"spark.sql.sources.partitionOverwriteMode\", \"DYNAMIC\") # Necessário para sobrescrever partições\n","user":"anonymous","dateUpdated":"2019-12-25T01:55:41-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1577225255818_1398164401","id":"20191221-124444_835401478","dateCreated":"2019-12-24T19:07:35-0300","dateStarted":"2019-12-25T01:31:15-0300","dateFinished":"2019-12-25T01:31:15-0300","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:309"},{"title":"Lê os dados da origem","text":"%pyspark\n\n# Lê a pouso de origem\npousoDF = spark.read.schema(schema_json).json(origem_pouso)","user":"anonymous","dateUpdated":"2019-12-25T01:32:49-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1577225255904_565472103","id":"20191221-124622_2019804708","dateCreated":"2019-12-24T19:07:35-0300","dateStarted":"2019-12-25T01:32:49-0300","dateFinished":"2019-12-25T01:32:53-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:310","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\npousoDF.printSchema()","user":"anonymous","dateUpdated":"2019-12-24T20:41:30-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- cpf: string (nullable = true)\n |-- customer_id: string (nullable = true)\n |-- customer_name: string (nullable = true)\n |-- delivery_address_city: string (nullable = true)\n |-- delivery_address_country: string (nullable = true)\n |-- delivery_address_district: string (nullable = true)\n |-- delivery_address_external_id: string (nullable = true)\n |-- delivery_address_latitude: string (nullable = true)\n |-- delivery_address_longitude: string (nullable = true)\n |-- delivery_address_state: string (nullable = true)\n |-- delivery_address_zip_code: string (nullable = true)\n |-- items: string (nullable = true)\n |-- merchant_id: string (nullable = true)\n |-- merchant_latitude: string (nullable = true)\n |-- merchant_longitude: string (nullable = true)\n |-- merchant_timezone: string (nullable = true)\n |-- order_created_at: string (nullable = true)\n |-- order_id: string (nullable = true)\n |-- order_scheduled: boolean (nullable = true)\n |-- order_scheduled_date: string (nullable = true)\n |-- order_total_amount: double (nullable = true)\n |-- origin_platform: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1577225255938_-1513059700","id":"20191221-124723_98133630","dateCreated":"2019-12-24T19:07:35-0300","dateStarted":"2019-12-24T20:41:30-0300","dateFinished":"2019-12-24T20:41:30-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:311"},{"text":"%pyspark\n\npousoDF.show(1, False)","user":"anonymous","dateUpdated":"2019-12-24T19:43:21-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\n|cpf        |customer_id                         |customer_name|delivery_address_city|delivery_address_country|delivery_address_district|delivery_address_external_id|delivery_address_latitude|delivery_address_longitude|delivery_address_state|delivery_address_zip_code|items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |merchant_id                         |merchant_latitude|merchant_longitude|merchant_timezone|order_created_at        |order_id                            |order_scheduled|order_scheduled_date|order_total_amount|origin_platform|\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\n|80532101763|977b9a89-825f-464b-8ef6-0f453d7334c1|GUSTAVO      |FRANCA               |BR                      |JARDIM ESPRAIADO         |6736655                     |-47.39                   |-20.55                    |SP                    |14403                    |[{\"name\": \"Parmegiana de Filé de Frango (2 pessoas)\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"2800\", \"currency\": \"BRL\"}, \"externalId\": \"0bcd6764fd5e466d9c04b18ac0eb69e6\", \"totalValue\": {\"value\": \"2800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"COM Arroz branco\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"13HDH\", \"externalId\": \"384bd2b4eb7d454d8e0274e7d590ab4f\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"PERSONALIZAR\", \"integrationId\": null}], \"integrationId\": \"PMFR\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"Lasanha Frango (2 pessoas)\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"externalId\": \"a361f5eec6a44ac0817892e81bf22e80\", \"totalValue\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": \"LF\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]|eb4197f9-964c-4f87-8307-709e498aab87|-47.39           |-20.55            |America/Sao_Paulo|2019-01-17T22:50:06.000Z|dd4f8f0a-c2cb-45c6-a002-c3be6b305e5f|false          |null                |46.0              |ANDROID        |\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\nonly showing top 1 row\n\n"}]},"apps":[],"jobName":"paragraph_1577225255939_-1959755837","id":"20191221-124732_945883820","dateCreated":"2019-12-24T19:07:35-0300","dateStarted":"2019-12-24T19:43:22-0300","dateFinished":"2019-12-24T19:43:23-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:312"},{"title":"Altera o schema da coluna items para ser reconhecida como um array","text":"%pyspark\n\npousoDF_ = pousoDF \\\n    .withColumn(\"items\", from_json(\"items\", ArrayType(schema_items)))\n    \n#pousoDF_.printSchema()","user":"anonymous","dateUpdated":"2019-12-25T01:59:02-0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1577231095216_998553003","id":"20191224-204455_355743703","dateCreated":"2019-12-24T20:44:55-0300","dateStarted":"2019-12-25T01:33:10-0300","dateFinished":"2019-12-25T01:33:10-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:313"},{"text":"%pyspark\n\npousoDF_.show(1, False)","user":"anonymous","dateUpdated":"2019-12-24T21:21:39-0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\n|cpf        |customer_id                         |customer_name|delivery_address_city|delivery_address_country|delivery_address_district|delivery_address_external_id|delivery_address_latitude|delivery_address_longitude|delivery_address_state|delivery_address_zip_code|items                                                                                                                                                                                                                                                                                                                                                                                                                                           |merchant_id                         |merchant_latitude|merchant_longitude|merchant_timezone|order_created_at        |order_id                            |order_scheduled|order_scheduled_date|order_total_amount|origin_platform|\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\n|80532101763|977b9a89-825f-464b-8ef6-0f453d7334c1|GUSTAVO      |FRANCA               |BR                      |JARDIM ESPRAIADO         |6736655                     |-47.39                   |-20.55                    |SP                    |14403                    |[[Parmegiana de Filé de Frango (2 pessoas), [0, BRL], [0, BRL], 1.0, 1, [2800, BRL], 0bcd6764fd5e466d9c04b18ac0eb69e6, [2800, BRL],, [[COM Arroz branco, [0, BRL], [0, BRL], 1.0, 2, [0, BRL], 13HDH, 384bd2b4eb7d454d8e0274e7d590ab4f, [0, BRL], PERSONALIZAR,]], PMFR, [0, BRL], [0, BRL]], [Lasanha Frango (2 pessoas), [0, BRL], [0, BRL], 1.0, 3, [1800, BRL], a361f5eec6a44ac0817892e81bf22e80, [1800, BRL],, [], LF, [0, BRL], [0, BRL]]]|eb4197f9-964c-4f87-8307-709e498aab87|-47.39           |-20.55            |America/Sao_Paulo|2019-01-17T22:50:06.000Z|dd4f8f0a-c2cb-45c6-a002-c3be6b305e5f|false          |null                |46.0              |ANDROID        |\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\nonly showing top 1 row\n\n"}]},"apps":[],"jobName":"paragraph_1577231208399_-935178739","id":"20191224-204648_1749835443","dateCreated":"2019-12-24T20:46:48-0300","dateStarted":"2019-12-24T21:21:39-0300","dateFinished":"2019-12-24T21:21:43-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:314"},{"text":"%pyspark\n\norigem_teste = \"hdfs://localhost:9000/ifood-landing-order/teste/\"\npousoDF.select(\"order_id\", \"items\") \\\n    .withColumn(\"items\", from_json(\"items\", ArrayType(schema_items))) \\\n    .limit(10).write.mode(\"overwrite\").format(\"json\").save(origem_teste)\nteste = spark.read.json(origem_teste)","user":"anonymous","dateUpdated":"2019-12-24T20:42:26-0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1577228266492_-2082571044","id":"20191224-195746_705611434","dateCreated":"2019-12-24T19:57:46-0300","dateStarted":"2019-12-24T20:42:26-0300","dateFinished":"2019-12-24T20:42:27-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:315"},{"text":"%pyspark\n\nteste.printSchema()","user":"anonymous","dateUpdated":"2019-12-24T20:42:30-0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- items: array (nullable = true)\n |    |-- element: struct (containsNull = true)\n |    |    |-- addition: struct (nullable = true)\n |    |    |    |-- currency: string (nullable = true)\n |    |    |    |-- value: string (nullable = true)\n |    |    |-- customerNote: string (nullable = true)\n |    |    |-- discount: struct (nullable = true)\n |    |    |    |-- currency: string (nullable = true)\n |    |    |    |-- value: string (nullable = true)\n |    |    |-- externalId: string (nullable = true)\n |    |    |-- garnishItems: array (nullable = true)\n |    |    |    |-- element: struct (containsNull = true)\n |    |    |    |    |-- addition: struct (nullable = true)\n |    |    |    |    |    |-- currency: string (nullable = true)\n |    |    |    |    |    |-- value: string (nullable = true)\n |    |    |    |    |-- categoryId: string (nullable = true)\n |    |    |    |    |-- categoryName: string (nullable = true)\n |    |    |    |    |-- discount: struct (nullable = true)\n |    |    |    |    |    |-- currency: string (nullable = true)\n |    |    |    |    |    |-- value: string (nullable = true)\n |    |    |    |    |-- externalId: string (nullable = true)\n |    |    |    |    |-- name: string (nullable = true)\n |    |    |    |    |-- quantity: double (nullable = true)\n |    |    |    |    |-- sequence: long (nullable = true)\n |    |    |    |    |-- totalValue: struct (nullable = true)\n |    |    |    |    |    |-- currency: string (nullable = true)\n |    |    |    |    |    |-- value: string (nullable = true)\n |    |    |    |    |-- unitPrice: struct (nullable = true)\n |    |    |    |    |    |-- currency: string (nullable = true)\n |    |    |    |    |    |-- value: string (nullable = true)\n |    |    |-- integrationId: string (nullable = true)\n |    |    |-- name: string (nullable = true)\n |    |    |-- quantity: double (nullable = true)\n |    |    |-- sequence: long (nullable = true)\n |    |    |-- totalAddition: struct (nullable = true)\n |    |    |    |-- currency: string (nullable = true)\n |    |    |    |-- value: string (nullable = true)\n |    |    |-- totalDiscount: struct (nullable = true)\n |    |    |    |-- currency: string (nullable = true)\n |    |    |    |-- value: string (nullable = true)\n |    |    |-- totalValue: struct (nullable = true)\n |    |    |    |-- currency: string (nullable = true)\n |    |    |    |-- value: string (nullable = true)\n |    |    |-- unitPrice: struct (nullable = true)\n |    |    |    |-- currency: string (nullable = true)\n |    |    |    |-- value: string (nullable = true)\n |-- order_id: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1577229590524_1002939","id":"20191224-201950_1928243218","dateCreated":"2019-12-24T20:19:50-0300","dateStarted":"2019-12-24T20:42:31-0300","dateFinished":"2019-12-24T20:42:31-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:316"},{"text":"%pyspark\n\nteste.show(5, False)","user":"anonymous","dateUpdated":"2019-12-24T20:43:01-0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+\n|items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |order_id                            |\n+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+\n|[[[BRL, 0],, [BRL, 0], 0bcd6764fd5e466d9c04b18ac0eb69e6, [[[BRL, 0], 13HDH, PERSONALIZAR, [BRL, 0], 384bd2b4eb7d454d8e0274e7d590ab4f, COM Arroz branco, 1.0, 2, [BRL, 0], [BRL, 0]]], PMFR, Parmegiana de Filé de Frango (2 pessoas), 1.0, 1, [BRL, 0], [BRL, 0], [BRL, 2800], [BRL, 2800]], [[BRL, 0],, [BRL, 0], a361f5eec6a44ac0817892e81bf22e80, [], LF, Lasanha Frango (2 pessoas), 1.0, 3, [BRL, 0], [BRL, 0], [BRL, 1800], [BRL, 1800]]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |dd4f8f0a-c2cb-45c6-a002-c3be6b305e5f|\n|[[[BRL, 0],, [BRL, 0], e0e81b2027c241cca5bf60a4768800ec, [[[BRL, 0], 1J3T0, escolha sua porção , [BRL, 0], b869c10747d1417d8968d7e3e1bd7de4, 334 - 1/2 porção , 1.0, 2, [BRL, 7350], [BRL, 7350]]],, Filé Mignon à Cubana, 1.0, 1, [BRL, 0], [BRL, 0], [BRL, 0], [BRL, 0]], [[BRL, 0],, [BRL, 0], 4436f76edc164052aaf3c21a6567b570, [],, 603- Pudim de leite, 1.0, 4, [BRL, 0], [BRL, 0], [BRL, 800], [BRL, 800]], [[BRL, 0],, [BRL, 0], c0b788e876c54f198307dc142fed7aff, [],, 601-Torta Holandesa, 1.0, 5, [BRL, 0], [BRL, 0], [BRL, 800], [BRL, 800]], [[BRL, 0],, [BRL, 0], 385fb04a358340878b14116df9970e46, [],, 513 - Guarnição Completa II, 1.0, 3, [BRL, 0], [BRL, 0], [BRL, 1500], [BRL, 1500]]]                                                                                                                                                                                                          |8dd80f0b-db00-4b88-b7e2-02ca706fc5a5|\n|[[[BRL, 0],, [BRL, 0], 87a24efdd88c4b7b8bf1132cabfd4195, [[[BRL, 0], 0025, Escolha a sua Preferência, [BRL, 0], 2b89a4d4d6f14541a8830e5808d1f09f, TRADICIONAL, 1.0, 2, [BRL, 0], [BRL, 0]], [[BRL, 0], SABOR, Escolha um sabor, [BRL, 0], c7f63cc58a3643c7aa3f24858c7029f4, 1/2 21 - PIZZA FRANGO COM BACON E CATUPIRY , 1.0, 3, [BRL, 1750], [BRL, 1750]], [[BRL, 0], SABOR2, Escolha o segundo sabor, [BRL, 0], c7f63cc58a3643c7aa3f24858c7029f4, 1/2 21 - PIZZA FRANGO COM BACON E CATUPIRY , 1.0, 3, [BRL, 1750], [BRL, 1750]], [[BRL, 0], SABOR, Escolha um sabor, [BRL, 0], 0dcd4a195d6243ec806eb5a29682c797, 1/2 29 - PIZZA À MODA DA CASA, 1.0, 4, [BRL, 1750], [BRL, 1750]], [[BRL, 0], SABOR2, Escolha o segundo sabor, [BRL, 0], 0dcd4a195d6243ec806eb5a29682c797, 1/2 29 - PIZZA À MODA DA CASA, 1.0, 4, [BRL, 1750], [BRL, 1750]]],, GRANDE 2 SABORES, 1.0, 1, [BRL, 0], [BRL, 0], [BRL, 0], [BRL, 0]]]|430f9887-a563-45ee-8001-1cb29597d9dd|\n|[[[BRL, 0],, [BRL, 0], 5b598957c69a4aa68e02a20e3ce617a1, [],, CALABRESA, 1.0, 1, [BRL, 0], [BRL, 0], [BRL, 2040], [BRL, 2040]], [[BRL, 0], Sem tomate, [BRL, 0], 3a64b961d342467ea23792556c99f7c2, [],, CHEESE SALADA, 1.0, 2, [BRL, 0], [BRL, 0], [BRL, 2040], [BRL, 2040]]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |1294917e-2247-4891-a183-4a4d4a3fa356|\n|[[[BRL, 0],, [BRL, 0], 83127d50665f4a269febd427eb49306b, [[[BRL, 0], 0025, Escolha a sua Preferência, [BRL, 0], e9a71c078a6045eabb09bd4d38b991c6, BORDA CATUPIRY GRÁTIS , 1.0, 2, [BRL, 0], [BRL, 0]], [[BRL, 0], SABOR, Escolha um sabor, [BRL, 0], 46510932dfd448af910ae16e112a8d3a, 1/2 MISTA, 1.0, 3, [BRL, 2425], [BRL, 2425]], [[BRL, 0], SABOR2, Escolha o segundo sabor, [BRL, 0], 46510932dfd448af910ae16e112a8d3a, 1/2 MISTA, 1.0, 3, [BRL, 2425], [BRL, 2425]], [[BRL, 0], SABOR, Escolha um sabor, [BRL, 0], 5be89603526f4c42a6d9ac9e05f8a19a, 1/2 À MODA CAPIXABA, 1.0, 4, [BRL, 2425], [BRL, 2425]], [[BRL, 0], SABOR2, Escolha o segundo sabor, [BRL, 0], 5be89603526f4c42a6d9ac9e05f8a19a, 1/2 À MODA CAPIXABA, 1.0, 4, [BRL, 2425], [BRL, 2425]]],, GRANDE (35CM) 8 PDÇ 2 SABORES, 1.0, 1, [BRL, 0], [BRL, 0], [BRL, 0], [BRL, 0]]]                                                                |34755d74-781a-461b-8564-45a4e8d99dbd|\n+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1577230973403_-1122160944","id":"20191224-204253_1065405653","dateCreated":"2019-12-24T20:42:53-0300","dateStarted":"2019-12-24T20:43:01-0300","dateFinished":"2019-12-24T20:43:02-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:317"},{"text":"%pyspark\n\n# Verificação de duplicidade na(s) chave(s)\n# Possuímos duplicidade na(s) chave(s) logo devemos verificar!\npousoDF.groupBy(\"order_id\").agg(count(\"*\").alias(\"dup\")).filter(col(\"dup\") > 1).show(5, False)","user":"anonymous","dateUpdated":"2019-12-24T19:07:35-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------------------------+---+\n|order_id                            |dup|\n+------------------------------------+---+\n|20f03b24-f730-4b5e-9109-13046ddd0d96|2  |\n|6f2cf11d-7dee-476b-819f-406849182a8b|2  |\n|bb49078a-040b-4153-ab80-eaf384052df0|2  |\n|ad12c3a6-512c-41c9-b597-33be7fb931bd|2  |\n|0d40927c-9c95-4a25-a56d-db5942a2352c|2  |\n+------------------------------------+---+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1577225255939_402387950","id":"20191221-124745_36091137","dateCreated":"2019-12-24T19:07:35-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:318"},{"text":"%pyspark\n\n# Aqui notamos que a duplicidade vem do fato de termos mesmos customer_ids com cpfs distintos o que é improvável dado que o cpf é único por pessoa\n# Outro detalhe é que temos order_created_at diferentes para um mesmo order_id\npousoDF.filter(col(\"order_id\") == \"20f03b24-f730-4b5e-9109-13046ddd0d96\").show(5, False)","user":"anonymous","dateUpdated":"2019-12-24T19:07:35-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\n|cpf        |customer_id                         |customer_name|delivery_address_city|delivery_address_country|delivery_address_district|delivery_address_external_id|delivery_address_latitude|delivery_address_longitude|delivery_address_state|delivery_address_zip_code|items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |merchant_id                         |merchant_latitude|merchant_longitude|merchant_timezone|order_created_at        |order_id                            |order_scheduled|order_scheduled_date|order_total_amount|origin_platform|\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\n|51245332952|6fb1bd29-be67-4da8-8813-9c7adec48342|GLAUBER      |MARILIA              |BR                      |JARDIM PORTAL DO SOL     |7350959                     |-49.94                   |-22.23                    |SP                    |17519                    |[{\"name\": \"Polenta Frita 500g\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"externalId\": \"30be8ee82ab241109f82ccb3478bd3ff\", \"totalValue\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"CROC-TORI\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"2500\", \"currency\": \"BRL\"}, \"externalId\": \"b07cd13753054ba98b131344101062ea\", \"totalValue\": {\"value\": \"5000\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"- Molho SIM\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"14I31\", \"externalId\": \"05fe15e3df5b4cc68de41fbaf7f82cf6\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Enviar Molho que Acompanha ?\", \"integrationId\": null}], \"integrationId\": \"0000\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]|9dbb8bd7-2503-44f0-9012-17beebc3ced6|-49.94           |-22.23            |America/Sao_Paulo|2019-01-28T21:43:09.000Z|20f03b24-f730-4b5e-9109-13046ddd0d96|false          |null                |68.0              |ANDROID        |\n|05383195513|6fb1bd29-be67-4da8-8813-9c7adec48342|GLAUBER      |MARILIA              |BR                      |JARDIM PORTAL DO SOL     |7350959                     |-49.94                   |-22.23                    |SP                    |17519                    |[{\"name\": \"Polenta Frita 500g\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"externalId\": \"30be8ee82ab241109f82ccb3478bd3ff\", \"totalValue\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": null, \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"CROC-TORI\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"2500\", \"currency\": \"BRL\"}, \"externalId\": \"b07cd13753054ba98b131344101062ea\", \"totalValue\": {\"value\": \"5000\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"- Molho SIM\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 2.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"14I31\", \"externalId\": \"05fe15e3df5b4cc68de41fbaf7f82cf6\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"Enviar Molho que Acompanha ?\", \"integrationId\": null}], \"integrationId\": \"0000\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]|9dbb8bd7-2503-44f0-9012-17beebc3ced6|-49.94           |-22.23            |America/Sao_Paulo|2018-12-29T21:43:09.000Z|20f03b24-f730-4b5e-9109-13046ddd0d96|false          |null                |68.0              |ANDROID        |\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+\n\n"}]},"apps":[],"jobName":"paragraph_1577225255939_283678994","id":"20191221-131619_2122087846","dateCreated":"2019-12-24T19:07:35-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:319"},{"title":"Cria e grava a tabela raw","text":"%pyspark\n\n# Cria a tabela raw\nrawDF = pousoDF_ \\\n    .withColumn(\"dt_proc\", current_date()) \\\n    .withColumn(\"dt\", col(\"order_created_at\").cast(DateType())) \\\n    .repartition(100, \"dt\")\n\nrawDF.write.partitionBy(\"dt\").mode(\"overwrite\").option(\"compression\", \"snappy\").format(\"parquet\").save(destino_raw)","user":"anonymous","dateUpdated":"2019-12-25T01:34:42-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1577225255940_-1429235003","id":"20191221-124855_1400670421","dateCreated":"2019-12-24T19:07:35-0300","dateStarted":"2019-12-25T01:34:42-0300","dateFinished":"2019-12-25T01:52:33-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:320","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nrawDF.show(1, False)","user":"anonymous","dateUpdated":"2019-12-24T19:07:35-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+----------+----------+\n|cpf        |customer_id                         |customer_name|delivery_address_city|delivery_address_country|delivery_address_district|delivery_address_external_id|delivery_address_latitude|delivery_address_longitude|delivery_address_state|delivery_address_zip_code|items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |merchant_id                         |merchant_latitude|merchant_longitude|merchant_timezone|order_created_at        |order_id                            |order_scheduled|order_scheduled_date|order_total_amount|origin_platform|dt_proc   |dt        |\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+----------+----------+\n|80532101763|977b9a89-825f-464b-8ef6-0f453d7334c1|GUSTAVO      |FRANCA               |BR                      |JARDIM ESPRAIADO         |6736655                     |-47.39                   |-20.55                    |SP                    |14403                    |[{\"name\": \"Parmegiana de Filé de Frango (2 pessoas)\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 1, \"unitPrice\": {\"value\": \"2800\", \"currency\": \"BRL\"}, \"externalId\": \"0bcd6764fd5e466d9c04b18ac0eb69e6\", \"totalValue\": {\"value\": \"2800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [{\"name\": \"COM Arroz branco\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 2, \"unitPrice\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryId\": \"13HDH\", \"externalId\": \"384bd2b4eb7d454d8e0274e7d590ab4f\", \"totalValue\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"categoryName\": \"PERSONALIZAR\", \"integrationId\": null}], \"integrationId\": \"PMFR\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}, {\"name\": \"Lasanha Frango (2 pessoas)\", \"addition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"discount\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"quantity\": 1.00, \"sequence\": 3, \"unitPrice\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"externalId\": \"a361f5eec6a44ac0817892e81bf22e80\", \"totalValue\": {\"value\": \"1800\", \"currency\": \"BRL\"}, \"customerNote\": null, \"garnishItems\": [], \"integrationId\": \"LF\", \"totalAddition\": {\"value\": \"0\", \"currency\": \"BRL\"}, \"totalDiscount\": {\"value\": \"0\", \"currency\": \"BRL\"}}]|eb4197f9-964c-4f87-8307-709e498aab87|-47.39           |-20.55            |America/Sao_Paulo|2019-01-17T22:50:06.000Z|dd4f8f0a-c2cb-45c6-a002-c3be6b305e5f|false          |null                |46.0              |ANDROID        |2019-12-21|2019-01-17|\n+-----------+------------------------------------+-------------+---------------------+------------------------+-------------------------+----------------------------+-------------------------+--------------------------+----------------------+-------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------+-----------------+------------------+-----------------+------------------------+------------------------------------+---------------+--------------------+------------------+---------------+----------+----------+\nonly showing top 1 row\n\n"}]},"apps":[],"jobName":"paragraph_1577225255941_1154712592","id":"20191221-125227_830449066","dateCreated":"2019-12-24T19:07:35-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:321"},{"title":"Validação","text":"%pyspark\n\n# Leitura da base final\nrawDF_ = spark.read.parquet(destino_raw + \"/*/*.parquet\")\n\n# Validação Volumétrica\nprint(\"> Volumetria de saída equivale-se a de entrada ? --> {}\".format(pousoDF.count() == rawDF_.count()))\n\n# Validação do Schema\nschema = pousoDF.schema\nschema_ = rawDF_.drop(\"dt_proc\").schema\ncolunas = pousoDF.columns\ncolunas_ = rawDF_.drop(\"dt_proc\").columns\ncolunas.sort()\ncolunas_.sort()\nprint(\"> O schema de saída equivale-se ao de entrada ? ---> {}\".format(schema == schema_ or colunas == colunas_))","user":"anonymous","dateUpdated":"2019-12-24T19:07:35-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"> Volumetria de saída equivale-se a de entrada ? --> True\n> O schema de saída equivale-se ao de entrada ? ---> True\n"}]},"apps":[],"jobName":"paragraph_1577225255941_-1562895583","id":"20191221-125122_890996710","dateCreated":"2019-12-24T19:07:35-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:322"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2019-12-24T19:07:35-0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1577225255941_787577846","id":"20191221-134217_728581033","dateCreated":"2019-12-24T19:07:35-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:323"}],"name":"ifood-raw-order-dev","id":"2EWB4B3K9","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}